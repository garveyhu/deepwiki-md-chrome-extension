# DeepWiki to Markdown Enhanced

增强版 Chrome 插件，用于将 DeepWiki 文档下载为 Markdown 格式，支持页面内导出按钮、翻译内容导出和层级结构保留。

## 🆕 新功能特性

### 1. 页面内导出按钮

- **直接在页面上显示导出按钮**：不再需要点击插件图标
- **浮动式设计**：位于页面右上角，不影响阅读
- **双重选择**：支持单页导出和批量导出

### 2. 翻译内容支持

- **内置 Google Translate API 调用**：导出前自动为页面内容生成简体中文译文
- **逐节点翻译与缓存**：避免重复请求，保持原有段落与格式
- **翻译状态标识**：导出逻辑会检测译文完成后再进入 Markdown 转换

### 3. 层级结构保留

- **目录树结构保留**：批量导出时保持原有的文档层级关系
- **路径式文件命名**：根据目录层级自动生成文件路径
- **分层索引文件**：生成带缩进的目录索引

## 🚀 使用方法

### 方法一：页面内按钮（推荐）

1. 访问 DeepWiki 文档页面
2. 页面右上角会自动显示"导出"按钮
3. 点击按钮选择：
   - **导出当前页**：导出当前页面
   - **批量导出**：导出整个文档的所有页面

### 方法二：插件弹窗

1. 点击浏览器工具栏中的插件图标
2. 在弹窗中选择导出选项
3. 等待处理完成并下载

## 📋 翻译内容导出说明

### 内置翻译流程：

1. 启动单页或批量导出后，插件会收集页面上可见的文本节点
2. 文本会通过 `https://translate.googleapis.com` 转换为简体中文并写回页面
3. 翻译完成后立即执行 Markdown 转换与导出

### 使用提示：

- 需要能够访问 Google Translate 公共接口，建议在稳定网络环境中使用
- 默认输出为简体中文，可在弹窗下拉框或页面浮动按钮中切换其他语言
- 导出时状态提示会显示翻译进度，若长时间停留，可在控制台查看日志

## 📁 文件结构说明

### 单页导出

文件命名格式：`项目名-页面名.md`

### 批量导出

生成 ZIP 文件包含：

- `README.md`：包含完整目录索引
- 按层级结构组织的 Markdown 文件
- 文件名保持原有层级路径：`父目录/子目录/页面名.md`

## 🔧 技术改进

### 翻译检测机制

```javascript
// 内置翻译流水线
collectTextNodes()
  .filter(visible)
  .reduceWithCache()
  .translateViaApi("zh-CN")
  .applyToDom()
  .markPageTranslated();
```

### 层级结构解析

```javascript
// 递归解析目录树
-侧边栏DOM树遍历 - 层级深度计算 - 路径完整拼接 - 结构化数据存储;
```

### 异步处理优化

```javascript
// 页面导航和内容加载
-页面跳转等待 - DOM加载确认 - 翻译完成检测 - 内容稳定性确认;
```

## 🛠️ 安装方法

1. 下载项目文件
2. 打开 Chrome 浏览器 → 扩展程序 → 开发者模式
3. 选择"加载已解压的扩展程序"
4. 选择项目文件夹

## 📝 更新日志

### v0.1.0 (Enhanced)

- ✅ 添加页面内导出按钮
- ✅ 支持翻译内容导出
- ✅ 保留文档层级结构
- ✅ 优化批量导出流程
- ✅ 改进用户交互体验
- ✅ 增强错误处理机制

### v0.0.4 (Original)

- 基础单页导出功能
- 批量导出功能
- ZIP 打包下载

## 🐛 问题排查

### 导出按钮不显示

- 确认在 DeepWiki 页面
- 刷新页面重试
- 检查控制台错误信息

### 翻译内容未导出

- 确认网络可访问 `https://translate.googleapis.com`
- 查看浏览器控制台是否有接口请求被拦截（如公司代理或防火墙）
- 若频繁触发请求速率限制，可在设置中适当增加翻译间隔

### 层级结构错乱

- 确认侧边栏目录完整加载
- 检查页面 DOM 结构变化
- 重新导出尝试

## 💡 使用建议

1. **翻译导出**：建议先翻译整个标签页，等待稳定后再进行批量导出
2. **网络环境**：确保网络稳定，避免页面加载中断
3. **文件命名**：导出的文件会自动处理特殊字符，保持文件系统兼容
4. **大文档处理**：对于大型文档，建议分批次导出避免浏览器性能问题

## 📞 支持

如有问题或建议，请在项目 Issues 中反馈。

---

**注意**：此版本基于原版 DeepWiki to Markdown 插件增强开发，保持向后兼容性。
